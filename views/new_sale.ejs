<%- include('partials/header.ejs') %>


<head>
   <title>shopping cart</title>
   <style type="text/css">
    

 .modal{
    height: 100%;
   
 }

 .deletee{
    border: none;
 }

 
 

 td{
    font-size: 28px;
    font-weight: lighter;
 }

 input[type=text] {
        width: 50%;
        height: 60px;
        -webkit-transition: width 0.15s ease-in-out;
        transition: width 0.15s ease-in-out;
        text-align: left;
    }

    input[type=text]:focus {
        width: 100%;

    }

    input {
        border: 1px solid #999;
    }
 /* .show-cart li {
   display: flex;
 }
 .card {
   margin-bottom: 20px;
 }
 .card-img-top {
   width: 200px;
   height: 200px;
 } */

 

 
   </style>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
         integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
 
         
 <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
 </head>


 <body>

 



 <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
  <a href="/started" class="navbar-brand">Bibby</a>
  <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav">
          <a href="/allproducts" class="nav-item nav-link active">Product Control</a>
          <!-- <a href="#" class="nav-item nav-link">Profile</a>
          <a href="#" class="nav-item nav-link">Messages</a>
          <a href="#" class="nav-item nav-link disabled" tabindex="-1">Reports</a> --> 
      </div>
      <div class="navbar-nav ml-auto">
          <!-- <a href="#" class="nav-item nav-link btn btn-primary">Login</a> -->

          <button type="button" class="btn btn-primary" style="margin-right: 10px;" data-toggle="modal" data-target="#cart">Gross Items (<span class="total-count"></span>)</button><button class="clear-cart btn btn-secondary">Clear Items</button></div>

         

         
      
      </div>
  </div>
</nav>

<div class="container">

    
  <!-- <h1 class="mt-4 mb-4">All Blog Posts</h1> -->
  <!-- <input id="searchbar" onkeyup="search_animal()" type="text" name="search" placeholder="Search Posts.."> -->
  <h2 style="margin-top: 80px;">Make Sale</h2>
  <input type="text" class="form-control" style="margin-top: 30px;"  id="searchbar" onkeyup="search_animal()" name="search" placeholder="Search Products..">
  
  <div id="list">
      <div>

          <section class="carder">
              <div class="row">
                  <div class="col-md-6">
              
              <% for (key in products) { %>
              

                      <div id="list" class="card animals" style="margin-bottom: 20px; margin-top: 20px;">
                          <!-- <div class="card-header">
                            Featured
                          </div> -->
                          <div class="card-body animals">
                            <h5 class="card-title"><%= products[key].name %></h5>
                            <p class="card-text">₦<%= products[key].price %>.00</p>
                            

                            <a href="#" data-name="<%= products[key].name %>" data-price="<%= products[key].price %>" style="font-weight: bold;" class="add-to-cart btn btn-primary btn-sm">Add Item</a>
                          </div>
                        </div>
                      
                      <% } %>
                  </div>
                       
              </div>
              
              
          </section>


          </section>
      </div>

  </div>

 

  <h1 id="nothing" style="margin-bottom: 90px;">"Oops Nothing Returned For That Search, Try Something     Else"</h1>




</div>
</div>














 



    
            <!-- Modal -->
<div class="modal fade" style="background-color: white;" id="cart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-lg" style="max-width: 95%;" role="document">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title" id="exampleModalLabel">Bibby's Place</h5>
         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
           <span aria-hidden="true">&times;</span>
         </button>
       </div>
       <div class="modal-body">
         <table class="show-cart table">
           <th>Item</th>
           
         </table>
         <div style="font-size: 28px;">Total price: ₦<span class="total-cart"></span>.00</div>
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
         
         <button type="button" class="btn btn-primary" onclick="window.print()">Print Order</button>
         
       </div>
     </div>
   </div>
 </div> 



    




</div>

</body>

<script src="https://code.jquery.com/jquery-2.2.4.js"
    integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>


<script type="text/javascript">

function search_animal() {
    let input = document.getElementById('searchbar').value
    input = input.toLowerCase();
    let x = document.getElementsByClassName('animals');
    let nothing = document.getElementById('nothing');
    nothing.style.display = "none";
    for (i = 0; i < x.length; i++) {
        if (!x[i].innerHTML.toLowerCase().includes(input)) {
            x[i].style.display = "none";
            nothing.style.display = "block";
        } else {
            x[i].style.display = "list-item";
            nothing.style.display = "none";
        }
        
    }
    
}

  // ************************************************
// Shopping Cart API
// ************************************************

var shoppingCart = (function() {
  // =============================
  // Private methods and propeties
  // =============================
  cart = [];
  
  // Constructor
  function Item(name, price, count) {
    this.name = name;
    this.price = price;
    this.count = count;
  }
  
  // Save cart
  function saveCart() {
    sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
  }
  
    // Load cart
  function loadCart() {
    cart = JSON.parse(sessionStorage.getItem('shoppingCart'));
  }
  if (sessionStorage.getItem("shoppingCart") != null) {
    loadCart();
  }
  

  // =============================
  // Public methods and propeties
  // =============================
  var obj = {};
  
  // Add to cart
  obj.addItemToCart = function(name, price, count) {
    for(var item in cart) {
      if(cart[item].name === name) {
        cart[item].count ++;
        saveCart();
        return;
      }
    }
    var item = new Item(name, price, count);
    cart.push(item);
    saveCart();
  }
  // Set count from item
  obj.setCountForItem = function(name, count) {
    for(var i in cart) {
      if (cart[i].name === name) {
        cart[i].count = count;
        break;
      }
    }
  };
  // Remove item from cart
  obj.removeItemFromCart = function(name) {
      for(var item in cart) {
        if(cart[item].name === name) {
          cart[item].count --;
          if(cart[item].count === 0) {
            cart.splice(item, 1);
          }
          break;
        }
    }
    saveCart();
  }

  // Remove all items from cart
  obj.removeItemFromCartAll = function(name) {
    for(var item in cart) {
      if(cart[item].name === name) {
        cart.splice(item, 1);
        break;
      }
    }
    saveCart();
  }

  // Clear cart
  obj.clearCart = function() {
    cart = [];
    saveCart();
  }

  // Count cart 
  obj.totalCount = function() {
    var totalCount = 0;
    for(var item in cart) {
      totalCount += cart[item].count;
    }
    return totalCount;
  }

  // Total cart
  obj.totalCart = function() {
    var totalCart = 0;
    for(var item in cart) {
      totalCart += cart[item].price * cart[item].count;
    }
    return Number(totalCart.toFixed(2));
  }

  // List cart
  obj.listCart = function() {
    var cartCopy = [];
    for(i in cart) {
      item = cart[i];
      itemCopy = {};
      for(p in item) {
        itemCopy[p] = item[p];

      }
      itemCopy.total = Number(item.price * item.count).toFixed(2);
      cartCopy.push(itemCopy)
    }
    return cartCopy;
  }

  // cart : Array
  // Item : Object/Class
  // addItemToCart : Function
  // removeItemFromCart : Function
  // removeItemFromCartAll : Function
  // clearCart : Function
  // countCart : Function
  // totalCart : Function
  // listCart : Function
  // saveCart : Function
  // loadCart : Function
  return obj;
})();


// *****************************************
// Triggers / Events
// ***************************************** 
// Add item
$('.add-to-cart').click(function(event) {
  event.preventDefault();
  var name = $(this).data('name');
  var price = Number($(this).data('price'));
  shoppingCart.addItemToCart(name, price, 1);
  displayCart();
});

// Clear items
$('.clear-cart').click(function() {
  shoppingCart.clearCart();
  displayCart();
});


function displayCart() {
  var cartArray = shoppingCart.listCart();
  var output = "";
  for(var i in cartArray) {

    output += "<tr>"+"<th>"+"item"+"</th>"+"<th>"+"price"+"</th>"+"<th>"+"quantity"+"</th>"+"<th>"+"total"+"</th>"+"</tr>" + "<tr>" 
      
      + "<td>" + cartArray[i].name + "</td>" 
      + "<td>" + cartArray[i].price + "</td>"
      + "<td><div  class='minus input-group'><button style='border: none; background-color: white;' id='minus' class='minus-item input-group-addon btn' data-name=" + cartArray[i].name + ">-</button>"
      + "<input style='border: none; text-align: center; font-size: 28px;' type='number' class='plus item-count form-control' data-name='" + cartArray[i].name + "' value='" + cartArray[i].count + "'>"
      + "<button style='border: none; background-color: white;' id='add' class='plus-item btn  input-group-addon' data-name=" + cartArray[i].name + ">+</button></div></td>"
     
      + "<td>" + cartArray[i].total + "</td>" 
      + "<td><button style='font-size: 10px; border: none;' id='cancel' class='deletee delete-item btn btn-default'  data-name=" + cartArray[i].name + ">x</button></td>"
      + " = " 
      +  "</tr>";
  }
  $('.show-cart').html(output);
  $('.total-cart').html(shoppingCart.totalCart());
  $('.total-count').html(shoppingCart.totalCount());
}

function hideItem(){
   document.getElementById("minus").style.display = 'none';
   document.getElementById("add").style.display = 'none';
   document.getElementById("cancel").style.display = 'none';
}



// Delete item button

$('.show-cart').on("click", ".delete-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCartAll(name);
  displayCart();
})


// -1
$('.show-cart').on("click", ".minus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCart(name);
  displayCart();
})
// +1
$('.show-cart').on("click", ".plus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.addItemToCart(name);
  displayCart();
})

// Item count input
$('.show-cart').on("change", ".item-count", function(event) {
   var name = $(this).data('name');
   var count = Number($(this).val());
  shoppingCart.setCountForItem(name, count);
  displayCart();
});

displayCart();

</script>
<%- include('partials/footer.ejs') %>
